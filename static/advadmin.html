<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Advanced Admin - Camp Snackbar</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/css/admin.css">
    <link rel="stylesheet" href="/static/css/admin-nav.css">
</head>
<body>
    <!-- Advanced Admin Dashboard -->
    <div id="advAdminDashboard" class="admin-dashboard">
        <!-- Page Header with Gradient -->
        <header class="page-header">
            <h1>
                <img src="/static/images/IF_logo.png" alt="Logo" class="header-logo">
                Settings
            </h1>
            <div class="cross-page-nav">
                <a href="/index.html" id="posNavBtn" style="display: none;"><span class="icon">ğŸ›’</span> POS</a>
                <a href="/admin.html"><span class="icon">ğŸ“‹</span> Admin</a>
                <a href="/reports.html"><span class="icon">ğŸ“ˆ</span> Reports</a>
                <button onclick="window.authLogout()"><span class="icon">ğŸšª</span> Logout</button>
            </div>
        </header>

        <!-- In-Page Tab Navigation -->
        <nav class="tab-nav-bar">
            <a href="#" class="active" onclick="switchTab('general'); updateActiveNav(this); return false;"><span class="icon">âš™ï¸</span> General</a>
            <a href="#" onclick="switchTab('backups'); updateActiveNav(this); return false;"><span class="icon">ğŸ’¾</span> Backups</a>
            <a href="#" onclick="switchTab('prepqueue'); updateActiveNav(this); return false;"><span class="icon">â±ï¸</span> Prep Queue</a>
            <a href="#" onclick="switchTab('testdata'); updateActiveNav(this); return false;"><span class="icon">ğŸ§ª</span> Test Data</a>
        </nav>

        <div class="page-content">
            <div class="admin-content" style="padding: 2rem; overflow-y: auto; max-height: calc(100vh - 130px);">

            <!-- General Settings Tab -->
            <div id="generalTab" class="tab-content active">
                <div class="tab-header">
                    <h2>âš™ï¸ General Settings</h2>
                </div>
                <div class="admin-form" style="max-width: 600px;">
                    <div class="form-group">
                        <label for="campName">Camp Name</label>
                        <input type="text" id="campName" class="form-input" placeholder="Summer Camp Snack Bar">
                        <small style="color: #666;">Display name for your camp or organization</small>
                    </div>

                    <div class="form-group">
                        <label for="currencySymbol">Currency Symbol</label>
                        <input type="text" id="currencySymbol" class="form-input" placeholder="$" maxlength="3">
                        <small style="color: #666;">Currency symbol to display (e.g., $, â‚¬, Â£)</small>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button class="btn-primary" onclick="saveSettings()">ğŸ’¾ Save Settings</button>
                        <button class="btn-secondary" onclick="loadSettings()">ğŸ”„ Reset</button>
                    </div>
                </div>
            </div>

            <!-- Backups Tab -->
            <div id="backupsTab" class="tab-content">
                <div class="tab-header">
                    <h2>ğŸ’¾ Backup Settings</h2>
                </div>
                <div class="admin-form" style="max-width: 600px;">
                    <div class="form-group">
                        <label>Automatic Backups</label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="backupEnabled" style="width: auto; cursor: pointer;" onchange="updateBackupTimeVisibility()">
                            <span>Enable automatic database backups</span>
                        </label>
                        <small style="color: #666;">Automatically backup the database daily</small>
                    </div>

                    <div class="form-group" id="backupTimeGroup">
                        <label for="backupTime">Backup Time</label>
                        <input type="time" id="backupTime" class="form-input" value="00:00">
                        <small style="color: #666;">Time of day to perform automatic backup (24-hour format)</small>
                    </div>

                    <div class="form-group">
                        <label for="internetBackupUrl">Remote Backup Server (Optional)</label>
                        <input type="text" id="internetBackupUrl" class="form-input" placeholder="user@backup-server.com:/var/backups/camp-snackbar/">
                        <small style="color: #666;">
                            rsync destination for remote backups (format: <code>user@host:/path/</code>)<br>
                            Requires SSH key authentication. See <a href="/static/BACKUP_SETUP.md" target="_blank" style="color: #667eea;">backup documentation</a> for setup.
                        </small>
                    </div>

                    <div class="form-group">
                        <label>Backup Actions</label>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn-secondary" onclick="createManualBackup(false)">ğŸ’¾ Create Local Backup</button>
                            <button class="btn-secondary" onclick="createManualBackup(true)">â˜ï¸ Backup to Remote Server</button>
                            <button class="btn-secondary" onclick="viewBackupLog()">ğŸ“‹ View Backup Log</button>
                        </div>
                        <small style="color: #666;">Manually trigger backups or view backup history</small>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button class="btn-primary" onclick="saveSettings()">ğŸ’¾ Save Settings</button>
                        <button class="btn-secondary" onclick="loadSettings()">ğŸ”„ Reset</button>
                    </div>
                </div>
            </div>

            <!-- Prep Queue Tab -->
            <div id="prepqueueTab" class="tab-content">
                <div class="tab-header">
                    <h2>â±ï¸ Prep Queue Settings</h2>
                </div>
                <div class="admin-form" style="max-width: 600px;">
                    <p style="color: #666; margin-bottom: 1.5rem;">
                        Configure how long items can wait in the prep queue before they are highlighted as warnings or urgent.
                    </p>

                    <div class="form-group">
                        <label for="prepQueueWarningTime">Warning Time (Yellow - minutes)</label>
                        <input type="number" id="prepQueueWarningTime" class="form-input" placeholder="2" min="1" max="60">
                        <small style="color: #666;">Minutes before prep queue items turn yellow (default: 2 minutes)</small>
                    </div>

                    <div class="form-group">
                        <label for="prepQueueUrgentTime">Urgent Time (Red - minutes)</label>
                        <input type="number" id="prepQueueUrgentTime" class="form-input" placeholder="5" min="1" max="60">
                        <small style="color: #666;">Minutes before prep queue items turn red (default: 5 minutes)</small>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button class="btn-primary" onclick="saveSettings()">ğŸ’¾ Save Settings</button>
                        <button class="btn-secondary" onclick="loadSettings()">ğŸ”„ Reset</button>
                    </div>
                </div>
            </div>

            <!-- Test Data Tab -->
            <div id="testdataTab" class="tab-content">
                <div class="tab-header">
                    <h2>ğŸ§ª Test Data Management</h2>
                </div>
                <div style="max-width: 600px;">
                    <div style="padding: 1.5rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                        <p style="color: #666; margin-bottom: 1.5rem;">
                            Load or delete sample test data for development and demo purposes.
                            Test data includes 30 accounts (families, individuals, cabins) and 14 days of transaction history.
                        </p>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn-primary" onclick="loadTestData()" style="background: #28a745; border-color: #28a745;">
                                ğŸ“¥ Load Test Data
                            </button>
                            <button class="btn-secondary" onclick="deleteTestData()" style="background: #dc3545; border-color: #dc3545; color: white;">
                                ğŸ—‘ï¸ Delete Test Data
                            </button>
                        </div>
                        <div id="testDataStatus" style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 4px; display: none;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div class="spinner" id="testDataSpinner" style="display: none;"></div>
                                <span id="testDataMessage"></span>
                            </div>
                            <pre id="testDataOutput" style="margin-top: 0.5rem; padding: 0.5rem; background: #f8f9fa; border-radius: 4px; font-size: 0.85rem; max-height: 300px; overflow-y: auto; display: none;"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Messages -->
    <div id="successMessage" class="toast hidden"></div>
    <div id="errorMessage" class="toast toast-error hidden"></div>

            </div>
        </div>
    </div>

    <!-- Authentication Check -->
    <script type="module">
        import { safeInitAuth } from './js/utils/auth.js';

        // Require Admin role only
        safeInitAuth('admin', (user) => {
            console.log('Advanced Admin authenticated:', user.username);

            // Show POS navigation button for admin users
            if (user.role === 'admin') {
                document.getElementById('posNavBtn').style.display = 'flex';
            }

            // Initialize dashboard data
            if (window.initAdvAdmin) {
                window.initAdvAdmin();
            }
        });
    </script>

    <script>
        // Update active navigation state
        function updateActiveNav(clickedLink) {
            // Remove active class from all tab links
            document.querySelectorAll('.tab-nav-bar a').forEach(link => {
                link.classList.remove('active');
            });
            // Add active class to clicked link
            clickedLink.classList.add('active');
        }
    </script>

    <script type="module" src="/static/js/advadmin.js"></script>
</body>
</html>
