<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Camp Snackbar</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="admin-dashboard">
        <header class="admin-header">
            <div class="header-left">
                <img src="/static/images/IF_logo.png" alt="Logo" class="header-logo">
                <h1>Camp Snackbar Admin</h1>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button id="posNavBtn" class="btn-prep-queue" onclick="window.location.href='/index.html'" title="POS Terminal" style="display: none;">
                    ðŸ›’
                </button>
                <button class="btn-prep-queue" onclick="window.location.href='/reports.html'" title="Reports">
                    ðŸ“Š
                </button>
                <button class="btn-prep-queue" onclick="logout()" title="Logout">
                    ðŸšª
                </button>
            </div>
        </header>

        <div class="admin-content">
            <!-- Navigation Tabs -->
            <nav class="admin-tabs">
                <button class="tab-button active" onclick="showTab('transactions')">Transactions</button>
                <button class="tab-button" onclick="showTab('accounts')">Accounts</button>
                <button class="tab-button" onclick="showTab('inventory')">Products</button>
                <button class="tab-button" onclick="showTab('categories')">Categories</button>
            </nav>

            <!-- Inventory Tab -->
            <div id="inventoryTab" class="tab-content">
                <div class="tab-header">
                    <h2>Inventory Management</h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <select id="productCategoryFilter" class="filter-select" onchange="filterProductsTable()">
                            <option value="">All Categories</option>
                        </select>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem;">
                            <input type="checkbox" id="showInactiveProducts" onchange="filterProductsTable()">
                            <span>Show Inactive</span>
                        </label>
                        <div class="search-box">
                            <input type="text" id="productSearchInput" class="search-input"
                                   placeholder="Search products..." oninput="filterProductsTable()">
                        </div>
                        <button class="btn-primary" onclick="showAddProductForm()">+ Add Product</button>
                    </div>
                </div>

                <div class="products-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Product Name</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th style="text-align: right;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Categories Tab -->
            <div id="categoriesTab" class="tab-content">
                <div class="tab-header">
                    <h2>Category Management</h2>
                    <button class="btn-primary" onclick="showAddCategoryForm()">+ Add Category</button>
                </div>

                <div class="products-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Category Name</th>
                                <th>Product Count</th>
                                <th style="text-align: right;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTableBody">
                            <!-- Categories loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Accounts Tab -->
            <div id="accountsTab" class="tab-content active">
                <div class="tab-header">
                    <h2>Account Management</h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <select id="accountStatusFilter" class="filter-select" onchange="loadAccounts()">
                            <option value="">All Accounts</option>
                            <option value="active" selected>Active Only</option>
                            <option value="inactive">Inactive Only</option>
                        </select>
                        <div class="search-box">
                            <input type="text" id="accountSearchInput" class="search-input"
                                   placeholder="Search accounts..." oninput="filterAccountsTable()">
                        </div>
                        <button class="btn-primary" onclick="showAddAccountForm()">+ Add Account</button>
                    </div>
                </div>

                <div class="accounts-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Account #</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Balance</th>
                                <th>Created</th>
                                <th style="text-align: right;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="accountsTableBody">
                            <!-- Accounts loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactionsTab" class="tab-content">
                <div class="tab-header">
                    <h2>Transaction History</h2>
                    <div class="filter-controls">
                        <select id="transactionTypeFilter" class="filter-select" onchange="loadTransactions()">
                            <option value="">All Types</option>
                            <option value="purchase">Purchase</option>
                            <option value="payment">Payment</option>
                            <option value="adjustment">Adjustment</option>
                        </select>
                    </div>
                </div>

                <div class="transactions-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Transaction #</th>
                                <th>Date/Time</th>
                                <th>Account</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th style="text-align: right;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsTableBody">
                            <!-- Transactions loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="productModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="productModalTitle">Add Product</h2>
                <button class="btn-close" onclick="hideProductModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="productForm" class="admin-form">
                    <input type="hidden" id="productId">
                    <div class="form-group">
                        <label for="productCategory">Category *</label>
                        <select id="productCategory" class="form-input" required>
                            <!-- Categories loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productName">Product Name *</label>
                        <input type="text" id="productName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Price ($) *</label>
                        <input type="number" id="productPrice" class="form-input"
                               step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="productActive" checked>
                            Active
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="productRequiresPrep">
                            Requires Preparation
                        </label>
                    </div>
                </form>
                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e0e0e0;">
                    <button class="btn-secondary" id="deleteProductBtn" onclick="deleteProductFromModal()" style="display: none; font-size: 0.9rem; padding: 0.5rem 1rem;">
                        Delete Product
                    </button>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="hideProductModal()">Cancel</button>
                <button class="btn-primary" onclick="saveProduct()">Save</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Category Modal -->
    <div id="categoryModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="categoryModalTitle">Add Category</h2>
                <button class="btn-close" onclick="hideCategoryModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="categoryForm" class="admin-form">
                    <input type="hidden" id="categoryId">
                    <div class="form-group">
                        <label for="categoryName">Category Name *</label>
                        <input type="text" id="categoryName" class="form-input" required>
                    </div>
                </form>
                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e0e0e0;">
                    <button class="btn-secondary" id="deleteCategoryBtn" onclick="deleteCategoryFromModal()" style="display: none; font-size: 0.9rem; padding: 0.5rem 1rem;">
                        Delete Category
                    </button>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="hideCategoryModal()">Cancel</button>
                <button class="btn-primary" onclick="saveCategory()">Save</button>
            </div>
        </div>
    </div>

    <!-- Transaction Details Modal -->
    <div id="transactionModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Transaction Details</h2>
                <button class="btn-close" onclick="hideTransactionModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="transactionDetails" class="transaction-details">
                    <!-- Details loaded dynamically -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="hideTransactionModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Account Modal -->
    <div id="accountModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="accountModalTitle">Add Account</h2>
                <button class="btn-close" onclick="hideAccountModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="accountForm" class="admin-form">
                    <input type="hidden" id="accountId">
                    <div class="form-group">
                        <label for="accountName">Account Name *</label>
                        <input type="text" id="accountName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="accountType">Account Type *</label>
                        <select id="accountType" class="form-input" required onchange="toggleFamilyMembersField()">
                            <option value="individual">Individual</option>
                            <option value="family">Family</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="accountActive" checked>
                            Active
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="accountNotes">Notes</label>
                        <textarea id="accountNotes" class="form-input" rows="3"
                                  style="min-height: auto; resize: vertical;"></textarea>
                    </div>
                    <div class="form-group" id="familyMembersGroup" style="display: none;">
                        <label for="familyMembers">Family Members (one per line)</label>
                        <textarea id="familyMembers" class="form-input" rows="4"
                                  style="min-height: auto; resize: vertical;"
                                  placeholder="Enter family member names, one per line"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="hideAccountModal()">Cancel</button>
                <button class="btn-primary" onclick="saveAccount()">Save</button>
            </div>
        </div>
    </div>

    <!-- Account Details Modal -->
    <div id="accountDetailsModal" class="modal hidden">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>Account Details</h2>
                <button class="btn-close" onclick="hideAccountDetailsModal()">âœ•</button>
            </div>
            <div class="modal-body" style="max-height: 70vh;">
                <div id="accountDetailsContent">
                    <!-- Details loaded dynamically -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="hideAccountDetailsModal()">Close</button>
                <button class="btn-primary" onclick="showAddFundsModal()">Add Funds</button>
            </div>
        </div>
    </div>

    <!-- Add Funds Modal -->
    <div id="addFundsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Funds</h2>
                <button class="btn-close" onclick="hideAddFundsModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="addFundsForm" class="admin-form">
                    <input type="hidden" id="fundsAccountId">
                    <div class="form-group">
                        <label for="fundsAccountName">Account</label>
                        <input type="text" id="fundsAccountName" class="form-input" readonly
                               style="background: #f8f9fa; cursor: not-allowed;">
                    </div>
                    <div class="form-group">
                        <label for="fundsAmount">Amount ($) *</label>
                        <input type="number" id="fundsAmount" class="form-input"
                               step="0.01" min="0.01" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="fundsNotes">Notes (Optional)</label>
                        <textarea id="fundsNotes" class="form-input" rows="3"
                                  style="min-height: auto; resize: vertical;"
                                  placeholder="Reason for payment..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="hideAddFundsModal()">Cancel</button>
                <button class="btn-primary" onclick="addFundsToAccount()">Add Funds</button>
            </div>
        </div>
    </div>

    <!-- Toast Messages -->
    <div id="successToast" class="toast toast-success hidden"></div>
    <div id="errorToast" class="toast toast-error hidden"></div>

    <!-- Authentication Check -->
    <script type="module">
        import { safeInitAuth } from './js/utils/auth.js';

        // Require Admin role only
        safeInitAuth('admin', (user) => {
            console.log('Admin authenticated:', user.username);

            // Show POS navigation button for admin users
            if (user.role === 'admin') {
                document.getElementById('posNavBtn').style.display = 'block';
            }

            // Initialize admin dashboard data
            if (window.initAdminDashboard) {
                window.initAdminDashboard();
            }
        });
    </script>

    <script type="module" src="/static/js/admin.js"></script>
</body>
</html>
